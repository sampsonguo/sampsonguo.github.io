<ul>
<li>LDA工具<br><br><a href="https://github.com/liuzhiqiangruc/dml/tree/master/tm">https://github.com/liuzhiqiangruc/dml/tree/master/tm</a></li>
<li>获取数据<br></li>
</ul>
<pre><code>hive -e &quot;
select a.user_id, a.item_id, a.preference
from
(
   ...
)
&quot; &gt; input_lda
</code></pre>
<ul>
<li>数据概况<ul>
<li>基础数据获取：见hql</li>
<li>数据整理：cat input_lda | awk -F”\t” ‘{ print $1”\t”$2 }’ &gt; input</li>
<li>数据形式：user_id \t item_id （后期可考虑tf-idf优化）</li>
<li>行数：1849296</li>
<li>用户数：678588</li>
<li>游戏数：3377</li>
</ul>
</li>
<li>运行命令</li>
</ul>
<pre><code>./lda -a 0.2 -b 0.01 -k 50 -n 1000 -s 100 -d ./input -o ./output

    参数说明:
     --------------------------------------------
           -t               算法类型1:基本lda，2:lda-collective，3:lda_time
           -r               运行模式，1:建模，2:burn-in
           -a               p(z|d) 的 Dirichlet 参数
           -b               p(w|z) 的 Dirichlet 参数
           -k               Topic个数
           -n               迭代次数
           -s               每多少次迭代输出一次结果
           -d               输入数据
           -o               输出文件目录,实现需要存在

  运行时长：10分钟左右
</code></pre>
<ul>
<li>关联名称<br><ul>
<li>处理word_topic矩阵，将ID和名称关联起来，为lda.csv</li>
</ul>
</li>
</ul>
<pre><code>Hql如下，
set hive.exec.compress.output=false;
create table xxxx
(
    id  int
) row format delimited
fields terminated by &#39;\t&#39;;

load data local inpath &#39;/output/f_word_topic&#39; OVERWRITE  into table xxxx;
</code></pre>
<ul>
<li>Item2Item计算</li>
</ul>
<pre><code>mport sys
import math
import heapq

items_D = {} ## key: id

def load_data():
    global items_D
    inFp = open(&quot;lda_norm_10.csv&quot;, &#39;r&#39;)
    while True:
        line = inFp.readline()
        if not line:
            break
        items = line.strip().split(&#39;,&#39;)
        if len(items) != 54:
            continue
        item_D = {}
        item_D[&#39;soft_package_name&#39;] = items[0]
        item_D[&#39;name&#39;] = items[1]
        item_D[&#39;id&#39;] = int(items[2])
        item_D[&#39;topics&#39;] = map(float, items[3:53])
        item_D[&#39;sum&#39;] = float(items[53])
        items_D[item_D[&#39;id&#39;]] = item_D


def dis1(A, B):
    return sum( A[&#39;topics&#39;][i] * B[&#39;topics&#39;][i] for i in range(50))

def dis2(A, B):
    return sum( 100 - abs(A[&#39;topics&#39;][i] - B[&#39;topics&#39;][i]) for i in range(50))

def search_similar():
    while True:
        line = sys.stdin.readline()
        idx = int(line.strip())
        itemX = items_D[idx]
        sim = -1.0
        for idy, itemy in items_D.items():
            simy = dis1(items_D[idx], items_D[idy])
            if (simy &gt; sim or sim &lt; 0) and idx!=idy:
                sim = simy
                itemY = itemy
        print &quot;%s\tass\t%s&quot;%(itemX[&#39;name&#39;], itemY[&#39;name&#39;])

load_data()
search_similar()
</code></pre>
<ul>
<li>效果展示<br><br><img src="/../../gitbook/images/LDA%E5%8E%9F%E7%90%86%E5%92%8C%E5%AE%9E%E8%B7%B5/302.png" alt="Local Image"><br></li>
</ul>
